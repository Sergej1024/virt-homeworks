# Домашнее задание к занятию "7.1. Инфраструктура как код"

## Задача 1. Выбор инструментов.

### Легенда

Через час совещание на котором менеджер расскажет о новом проекте. Начать работу над которым надо
будет уже сегодня.
На данный момент известно, что это будет сервис, который ваша компания будет предоставлять внешним заказчикам.
Первое время, скорее всего, будет один внешний клиент, со временем внешних клиентов станет больше.

Так же по разговорам в компании есть вероятность, что техническое задание еще не четкое, что приведет к большому
количеству небольших релизов, тестирований интеграций, откатов, доработок, то есть скучно не будет.  

Вам, как девопс инженеру, будет необходимо принять решение об инструментах для организации инфраструктуры.
На данный момент в вашей компании уже используются следующие инструменты:
- остатки Сloud Formation,
- некоторые образы сделаны при помощи Packer,
- год назад начали активно использовать Terraform,
- разработчики привыкли использовать Docker,
- уже есть большая база Kubernetes конфигураций,
- для автоматизации процессов используется Teamcity,
- также есть совсем немного Ansible скриптов,
- и ряд bash скриптов для упрощения рутинных задач.  

Для этого в рамках совещания надо будет выяснить подробности о проекте, что бы в итоге определиться с инструментами:

1. Какой тип инфраструктуры будем использовать для этого проекта: изменяемый или не изменяемый?
1. Будет ли центральный сервер для управления инфраструктурой?
1. Будут ли агенты на серверах?
1. Будут ли использованы средства для управления конфигурацией или инициализации ресурсов?

В связи с тем, что проект стартует уже сегодня, в рамках совещания надо будет определиться со всеми этими вопросами.

### В результате задачи необходимо

1. Ответить на четыре вопроса представленных в разделе "Легенда".
1. Какие инструменты из уже используемых вы хотели бы использовать для нового проекта?
1. Хотите ли рассмотреть возможность внедрения новых инструментов для этого проекта?

Если для ответа на эти вопросы недостаточно информации, то напишите какие моменты уточните на совещании.

> 1. Какой тип инфраструктуры будем использовать для этого проекта: изменяемый или не изменяемый?
>
> По скольку ТЗ еще нет, то будем использовать гибридный режим, а в последсвии переведем все на неизменяемый тип инфраструктуры. В начеле,
> когда изминений будет много можем использовать Ansible + Terraform для определения необходимых компонентов и конфигураций. Затем, когда
> релизы станут стабильными сможем перейти на шаблонизацию Packer + Terraform +Docker + Kubernetes.
>
> 2. Будет ли центральный сервер для управления инфраструктурой?
>
> Раз мы используем Ansible, Terraform то необходимости администрировать все с одной машины нет смысла, а вот создать сервер для
> хранения репозиториев и автоматизации процессов стоит. Думаю лучше всего подайдет корпоративный GitLab.
>
> 3. Будут ли агенты на серверах?
>
> У нас есть Ansible и Terraform, которым не нужны агенты.
>
> 4. Будут ли использованы средства для управления конфигурацией или инициализации ресурсов?
>
> Так они у нас уже используються Ansible и Terraform.
>
> 5. Какие инструменты из уже используемых вы хотели бы использовать для нового проекта?
>
> Packer - для создания образов
> Terraform - для управления инфраструктурой
> Docker - для контейнеризации приложений
> Kebernetes - для оркестрации контейнеризированных приложений
> Ansible - для управления конфигурациями
> Teamcity - автоматизация процессов CI/CD \
>
> 6. Хотите ли рассмотреть возможность внедрения новых инструментов для этого проекта?
>
> Стек ELK для сбора логов и журналов.
> Мониторинг Prometheus + Node Exporter + Grafana.
> Максильный перевод всех bash скриптов в Ansible


## Задача 2. Установка терраформ.

Официальный сайт: https://www.terraform.io/

Установите терраформ при помощи менеджера пакетов используемого в вашей операционной системе.
В виде результата этой задачи приложите вывод команды `terraform --version`.

```shell
[sergej@fedora ~]$ sudo dnf install -y dnf-plugins-core
[sudo] пароль для sergej:
Последняя проверка окончания срока действия метаданных: 0:42:02 назад, Ср 08 июн 2022 07:28:41.
Пакет dnf-plugins-core-4.2.1-1.fc36.noarch уже установлен.
Зависимости разрешены.
Отсутствуют действия для выполнения.
Выполнено!
[sergej@fedora ~]$ sudo dnf config-manager --add-repo https://rpm.releases.hashicorp.com/fedora/hashicorp.repo
Добавление репозитория из: https://rpm.releases.hashicorp.com/fedora/hashicorp.repo
[sergej@fedora ~]$ sudo dnf -y install terraform
Hashicorp Stable - x86_64                                                                             148 kB/s | 696 kB     00:04    
Последняя проверка окончания срока действия метаданных: 0:00:03 назад, Ср 08 июн 2022 08:15:35.
Зависимости разрешены.
======================================================================================================================================
 Пакет                            Архитектура                   Версия                         Репозиторий                      Размер
======================================================================================================================================
Установка:
 terraform                        x86_64                        1.2.2-1                        hashicorp                         13 M

Результат транзакции
======================================================================================================================================
Установка  1 Пакет

Объем загрузки: 13 M
Объем изменений: 60 M
Загрузка пакетов:
terraform-1.2.2-1.x86_64.rpm                                                                          449 kB/s |  13 MB     00:29    
--------------------------------------------------------------------------------------------------------------------------------------
Общий размер                                                                                          449 kB/s |  13 MB     00:29     
Hashicorp Stable - x86_64                                                                             2.2 kB/s | 3.1 kB     00:01    
Импорт GPG-ключа 0xA3219F7B:
Идентификатор пользователя:  "HashiCorp Security (HashiCorp Package Signing) <security+packaging@hashicorp.com>"
Отпечаток: E8A0 32E0 94D8 EB4E A189 D270 DA41 8C88 A321 9F7B
Источник:  https://rpm.releases.hashicorp.com/gpg
Импорт ключа успешно завершен
Проверка транзакции
Проверка транзакции успешно завершена.
Идет проверка транзакции
Тест транзакции проведен успешно.
Выполнение транзакции
  Подготовка       :                                                                                                              1/1
  Установка        : terraform-1.2.2-1.x86_64                                                                                     1/1
  Проверка         : terraform-1.2.2-1.x86_64                                                                                     1/1

Установлен:
  terraform-1.2.2-1.x86_64                                                                                                            

Выполнено!
[sergej@fedora ~]$ terraform --version
Terraform v1.2.2
on linux_amd64
[sergej@fedora ~]$
```

## Задача 3. Поддержка легаси кода.

В какой-то момент вы обновили терраформ до новой версии, например с 0.12 до 0.13.
А код одного из проектов настолько устарел, что не может работать с версией 0.13.
В связи с этим необходимо сделать так, чтобы вы могли одновременно использовать последнюю версию терраформа установленную при помощи
штатного менеджера пакетов и устаревшую версию 0.12.

В виде результата этой задачи приложите вывод `--version` двух версий терраформа доступных на вашем компьютере
или виртуальной машине.

```shell
[sergej@fedora ~]$ sudo mkdir -p /opt/terraform/0.15.5
[sudo] пароль для sergej:
[sergej@fedora ~]$ cd /opt/terraform/0.15.5
[sergej@fedora 0.15.5]$ sudo wget https://releases.hashicorp.com/terraform/0.15.5/terraform_0.15.5_linux_amd64.zip
--2022-06-08 08:38:49--  https://releases.hashicorp.com/terraform/0.15.5/terraform_0.15.5_linux_amd64.zip
Подключение к 192.168.17.250:3128... соединение установлено.
Proxy-запрос отправлен. Ожидание ответа… 200 OK
Длина: 33043317 (32M) [application/zip]
Сохранение в: «terraform_0.15.5_linux_amd64.zip»

terraform_0.15.5_linux_amd64.zip                            100%[=========================================================================================================================================>]  31,51M   195KB/s    за 2m 50s  

2022-06-08 08:41:40 (190 KB/s) - «terraform_0.15.5_linux_amd64.zip» сохранён [33043317/33043317]

[sergej@fedora 0.15.5]$ sudo unzip terraform_0.15.5_linux_amd64.zip
Archive:  terraform_0.15.5_linux_amd64.zip
  inflating: terraform               
[sergej@fedora 0.15.5]$ sudo ln -s /opt/terraform/0.15.5/terraform /usr/bin/terraform15
[sergej@fedora 0.15.5]$ sudo chmod +x /usr/bin/terraform15
[sergej@fedora 0.15.5]$ terraform15 --version
Terraform v0.15.5
on linux_amd64

Your version of Terraform is out of date! The latest version
is 1.2.2. You can update by downloading from https://www.terraform.io/downloads.html
[sergej@fedora 0.15.5]$ terraform --version
Terraform v1.2.2
on linux_amd64
[sergej@fedora 0.15.5]$
```
